import { NextPage } from "next";
import Head from "next/head";
import Image from "next/image";
import Link from "next/link";
import Footer from "../components/Footer";
import Header from "../components/Header";
import {showModel, showPrompt} from "../components/Genhis";

import PromptSlider  from "../components/imageSlider";
import SquigglyLines from "../components/SquigglyLines";
import { Testimonials } from "../components/Testimonials";
import { useSession, signIn } from "next-auth/react";
import {Prompt, Model } from "@prisma/client";

import prisma from "../lib/prismadb";
import { getServerSession } from "next-auth";
import { authOptions } from "../pages/api/auth/[...nextauth]";

//  {status === "authenticated" && data && !restoredImage && (


export async function getServerSideProps(ctx: any) {

  const session = await getServerSession(ctx.req, ctx.res, authOptions);
 
  // 如果用户没登录显示最热门的，如果已经登录显示最新的
  const isLogin = session && session.user  && session.user.email ? true : false;
  
  // 推荐8个提示词，逻辑将来再改
  let prompts = await prisma.prompt.findMany({
    where: {
        status: "FINISH",
        access: "PUBLIC",
    },
    orderBy: isLogin ? {
          createTime: 'desc',
        } : { runtimes: 'desc',},    
    select: {
      id: true,
      code: true,
      name: true,
      price: true,
      coverImg: true,
      runtimes: true,
    },
    take: 8, // 只返回前8行数据
  });
  
  // 推荐8个模型
  let models =  await prisma.model.findMany({
    where: {
      status: "FINISH",
      access: "PUBLIC",      
    },
    orderBy: isLogin ? {
          createTime: 'desc',
        } : { runtimes: 'desc',},  
    select: {
      id: true,
      code: true,
      name: true,
      price: true,
      coverImg: true,
      runtimes: true,
    },
    take: 8, // 只返回前8行数据
  });  
  
  return {
    props: {
      models,
      prompts,
    },
  };
}  


// const Home: NextPage = () => {
export default function index({ models, prompts }: { models: Model[], prompts: Prompt[] }) {
  
  /*
          <div className="flex flex-col sm:flex-row  items-center space-y-5 space-x-10 mt-4 mb-16">

            <button
                onClick={() => {
                  window.location.href = "/promptMarket";
                }}
                className="bg-black rounded-full text-white border-1 h-10 border-blue-500 font-medium px-4 py-2 mt-8 hover:bg-gray-100 transition"
              >
            提示词集市
            </button>
          
            <button
                onClick={() => {
                  window.location.href = "/modelMarket" ;
                }}
                className="bg-black rounded-full text-white border-1 h-10 border-blue-500 font-medium px-4 py-2 mt-8 hover:bg-gray-100 transition"
              >
            模型集市
            </button>
          
       </div>
  */
  
   
  
  
  
  const { data: session, status } = useSession();

  return (
    <div className="flex mx-auto flex-col items-center justify-center min-h-screen ">
      <Head>
        <title>AI菩提</title>
      </Head>
      <Header/>

      <main className="flex flex-1 w-full flex-col items-center justify-center text-center sm:px-4 px-0 py-6 background-gradient">
        <h1 className="mx-auto max-w-4xl font-display text-3xl font-bold tracking-normal text-white mb:50 sm:text-6xl">
          一起在
          <span className="relative whitespace-nowrap text-blue-300">
            <SquigglyLines />
            <span className="relative">AI集市</span>
          </span>{""}感受魔法
     
        </h1>

     <div className="flex justify-between items-center w-full flex-col sm:mt-25 mt-0">

       
          <div className="flex flex-col items-left space-y-5 mt-4 mb-16">
            <Link  href="/promptMarket" className="hidden sm:block">               
              <p className="flex max-w-fit items-center text-2xl text-white justify-center sm:mt-5 mt-3 space-x-2 rounded-lg px-5 py-2 shadow-md hover:bg-blue-400 hover:text-white bg-white-600 transition"> 
                精彩提示词 {">>>"}
              </p>
           </Link>              
           
            <div className="flex sm:space-x-2 sm:flex-row flex-col">
              {showPrompt(prompts[0])} 
              {showPrompt(prompts[1])} 
              {showPrompt(prompts[2])} 
              {showPrompt(prompts[3])} 
            </div>
            <div className="flex sm:space-x-2 sm:flex-row flex-col">
              {showPrompt(prompts[4])} 
              {showPrompt(prompts[5])} 
              {showPrompt(prompts[6])} 
              {showPrompt(prompts[7])} 
            </div>
        </div>
      </div>
        
     <div className="flex justify-between items-center w-full flex-col sm:mt-25 mt-5">
          <div className="flex flex-col items-left space-y-5 mt-4 mb-16">
            <Link  href="/modelMarket" className="hidden sm:block">               
              <p className="flex max-w-fit items-center text-2xl text-white justify-center sm:mt-5 mt-3 space-x-2 rounded-lg px-5 py-2 shadow-md hover:bg-blue-400 hover:text-white bg-white-600 transition"> 
                热门模型 {">>>"}
              </p>
           </Link>              
            <div className="flex sm:space-x-2 sm:flex-row flex-col">
              {showModel(models[0])}
              {showModel(models[1])}
              {showModel(models[2])}
              {showModel(models[3])}              
            </div>
            <div className="flex sm:space-x-2 sm:flex-row flex-col">
              {showModel(models[4])}
              {showModel(models[5])}
              {showModel(models[6])}
              {showModel(models[7])}
            </div>
        </div>
       
      </div>       
       
        
        <p className="flex max-w-fit items-center text-3xl text-white justify-center border-1  sm:mt-5 mt-3 space-x-2 rounded-lg px-5 py-2 shadow-md hover:bg-blue-400 hover:text-white bg-white-600 transition"> 
          实用AI工具
        </p>        
        
        
        
        <Link className="flex justify-between items-center w-full flex-col " href="/dream?price=10">
        
          <div className="flex flex-col items-left space-y-5 mt-4 mb-16">
          <span
           className="flex max-w-fit items-center text-lg sm:text-2xl text-white justify-center sm:mt-5 mt-3 space-x-2 rounded-lg px-5 py-2 shadow-md hover:bg-blue-400 hover:text-white bg-white-600 transition"

          >
          一键给你的家装修
         </span>
            
            <div className="flex sm:space-x-2 sm:flex-row flex-col">
              <div>
                <Image
                  alt="Original photo"
                  src="http://fileserver.aiputi.cn/demo/deco_in.jpg"
                  className="object-cover rounded-2xl"
                  width={512}
                  height={512}
                />
              </div>
              <div className="sm:mt-0 mt-8">
                <Image
                  alt="Generated photo"
                  width={512}
                  height={512}
                  src="http://fileserver.aiputi.cn/demo/deco_out.png"
                  className="object-cover  rounded-2xl sm:mt-0 mt-2"
                />
              </div>
              <div className="sm:mt-0 mt-8">
                <Image
                  alt="Generated photo"
                  width={512}
                  height={512}
                  src="http://fileserver.aiputi.cn/demo/deco_2.jpg"
                  className="object-cover  rounded-2xl sm:mt-0 mt-2"
                />
              </div>
              <div className="sm:mt-0 mt-8">
                <Image
                  alt="Generated photo"
                  width={512}
                  height={512}
                  src="http://fileserver.aiputi.cn/demo/deco_3.jpg"
                  className="object-cover  rounded-2xl sm:mt-0 mt-2"
                />
              </div>              
            </div>
          </div>
        </Link>

      
      
        <Link className="flex justify-between items-center w-full flex-col sm:mt-1 mt-3"    href="/draft?price=10">

          <div className="flex flex-col items-left space-y-5 mt-4 mb-16">
          <span
           className="flex max-w-fit items-center text-lg sm:text-2xl text-gray-100 justify-center sm:mt-5 mt-3 space-x-2 rounded-lg px-5 py-2 shadow-md hover:bg-blue-400 hover:text-white bg-white-600 transition"          >
          一键让草图变效果图
         </span>
            <div className="flex sm:space-x-2 sm:flex-row flex-col">
              <div>
                <Image
                  alt="Original photo"
                  src="http://fileserver.aiputi.cn/demo/draft_in.jpg"
                  className=" object-cover rounded-2xl"
                  width={512}
                  height={512}
                />
                 
              </div>
              <div className="sm:mt-0 mt-8">
                <Image
                  alt="Generated photo"
                  width={512}
                  height={512}
                  src="http://fileserver.aiputi.cn/demo/draft_out.png"
                  className="object-cover  rounded-2xl sm:mt-0 mt-2"
                />
              </div>
              <div className="sm:mt-0 mt-8">
                <Image
                  alt="Generated photo"
                  width={512}
                  height={512}
                  src="http://fileserver.aiputi.cn/demo/draft_2.jpg"
                  className="object-cover  rounded-2xl sm:mt-0 mt-2"
                />
              </div>
              <div className="sm:mt-0 mt-8">
                <Image
                  alt="Generated photo"
                  width={512}
                  height={512}
                  src="http://fileserver.aiputi.cn/demo/draft_3.jpg"
                  className="object-cover rounded-2xl sm:mt-0 mt-2"
                />
              </div>              
            </div>
          </div>
        </Link>

        
        <Link className="flex justify-between items-center w-full flex-col  sm:mt-1 mt-3"      href="/garden?price=10">
          <div className="flex flex-col space-y-10 mt-4 mb-16 items-left">
          <span
           className="flex max-w-fit items-center text-lg sm:text-2xl text-gray-100 justify-center sm:mt-5 mt-3 space-x-2 rounded-lg px-5 py-2 shadow-md hover:bg-blue-400 hover:text-white bg-white-600 transition"
          >
          一键改造花园
        </span>            
            <div className="flex sm:space-x-2 sm:flex-row flex-col">
              <div>
                <Image
                  alt="Original photo"
                  src="http://fileserver.aiputi.cn/demo/garden_in.jpg"
                  className=" object-cover  rounded-2xl"
                  width={512}
                  height={512}
                />
              </div>
              <div className="sm:mt-0 mt-8">
                <Image
                  alt="Generated photo"
                  width={512}
                  height={512}
                  src="http://fileserver.aiputi.cn/demo/garden_1.jpg"
                  className="object-cover  rounded-2xl sm:mt-0 mt-2"
                />
              </div>
              <div className="sm:mt-0 mt-8">
                <Image
                  alt="Generated photo"
                  width={512}
                  height={512}
                  src="http://fileserver.aiputi.cn/demo/garden_2.jpg"
                  className="object-cover  rounded-2xl sm:mt-0 mt-2"
                />
              </div>
              <div className="sm:mt-0 mt-8">
                <Image
                  alt="Generated photo"
                  width={512}
                  height={512}
                  src="http://fileserver.aiputi.cn/demo/garden_3.jpg"
                  className="object-cover  rounded-2xl sm:mt-0 mt-2"
                />
              </div>                
            </div>
          </div>
        </Link>        

  
        
        
        <Link className="flex justify-between items-center w-full flex-col sm:mt-1 mt-3" href="/photo2cartoon?price=4">
          <div className="flex flex-col space-y-10 mt-4 mb-16 items-left">
          <span
           className="flex max-w-fit items-center text-lg sm:text-2xl text-gray-100 justify-center sm:mt-5 mt-3 space-x-2 rounded-lg px-5 py-2 shadow-md hover:bg-blue-400 hover:text-white bg-white-600 transition"
          >
          照片转换动漫效果
        </span>
            
            <div className="flex sm:space-x-2 sm:flex-row flex-col">
              <div>
                <Image
                  alt="Original photo"
                  src="http://fileserver.aiputi.cn/demo/photo2cartoon_in.jpg"
                  className="object-cover  rounded-2xl"
                  width={512}
                  height={512}
                />
              </div>
              <div className="sm:mt-0 mt-8">
                <Image
                  alt="Generated photo"
                  width={512}
                  height={512}
                  src="http://fileserver.aiputi.cn/demo/photo2cartoon_out.jpg"
                  className="object-cover  rounded-2xl"
                />
              </div>
              <div className="sm:mt-0 mt-8">
                <Image
                  alt="Generated photo"
                  width={512}
                  height={512}
                  src="http://fileserver.aiputi.cn/demo/photo2cartoon_3.jpg"
                  className="object-cover rounded-2xl"
                />
              </div>
              <div className="sm:mt-0 mt-8">
                <Image
                  alt="Generated photo"
                  width={512}
                  height={512}
                  src="http://fileserver.aiputi.cn/demo/photo2cartoon_4.jpg"
                  className="object-cover  rounded-2xl"
                />
              </div>              
            </div>
          </div>
        </Link>
        
 
        <div className="flex justify-center items-center w-full flex-col sm:flex-row sm:mt-1 mt-3">
          <Link className="flex flex-col space-y-10 mt-4 mb-16 items-left" href="/changeBG?price=10">
            <span
             className="flex max-w-fit items-center text-lg sm:text-2xl text-gray-100 justify-center sm:mt-5 mt-3 space-x-2 rounded-lg px-5 py-2 shadow-md hover:bg-blue-400 hover:text-white bg-white-600 transition"
             >
                照片换背景
            </span>            
            
            <div className="flex sm:space-x-2 sm:flex-row flex-col">
              <div>
                <Image
                  alt="Original photo"
                  src="http://fileserver.aiputi.cn/demo/changebg_in.jpg"
                  className="object-cover rounded-2xl"
                  width={512}
                  height={512}
                />
              </div>
              <div className="sm:mt-0 mt-8">
                <Image
                  alt="Generated photo"
                  width={512}
                  height={512}
                  src="http://fileserver.aiputi.cn/demo/changebg_out.jpg"
                  className="object-cover  rounded-2xl sm:mt-0 mt-2"
                />
              </div>
            </div>
          </Link>
          <Link className="flex flex-col space-y-10 mt-4 mb-16 items-left" href="/removeBG?price=2">
            <span
             className="flex max-w-fit items-center text-lg sm:text-2xl text-gray-100 justify-center sm:mt-5 mt-3 space-x-2 rounded-lg px-5 py-2 shadow-md hover:bg-blue-400 hover:text-white bg-white-600 transition"
 
            >
                删除照片背景
            </span>            
          
           <div className="flex sm:space-x-2 sm:flex-row flex-col">
              <div className="sm:mt-0 mt-8">
                <Image
                  alt="Generated photo"
                  width={512}
                  height={512}
                  src="http://fileserver.aiputi.cn/demo/removeBG_in.jpg"
                  className="object-cover rounded-2xl sm:mt-0 mt-2"
                />
              </div>
              <div className="sm:mt-0 mt-8">
                <Image
                  alt="Generated photo"
                  width={512}
                  height={512}
                  src="http://fileserver.aiputi.cn/demo/removeBG_out.jpg"
                  className="object-cover  rounded-2xl sm:mt-0 mt-2"
                />
              </div>              
            </div>
          </Link>
        </div>
        
       
 
         <div className="flex justify-between items-center w-full flex-col sm:mt-1 mt-3">
          <h3
           className="flex max-w-fit items-center text-lg sm:text-2xl text-gray-100 justify-center sm:mt-5 mt-3 space-x-2 rounded-lg px-5 py-2 shadow-md hover:bg-blue-400 hover:text-white bg-white-600 transition"
          >
          ChatGPT 角色对话
        </h3>
          <div className="flex flex-col space-y-10 mt-4 mb-16">
            <div className="flex sm:space-x-2 lg:flex-row flex-col">
              <div>
                <h3 className="mb-1 font-medium text-lg">AI好导游</h3>
                <Link href="http://gpt.aiputi.cn/?actor=trip">
                  <Image
                    alt="Original photo"
                    src="http://fileserver.aiputi.cn/logo/trip_logo.png"
                    className="w-full object-cover rounded-2xl"
                    width={100}
                    height={100}
                  />
                </Link>
              </div>
              
              <div>
                <h3 className="mb-1 font-medium text-lg">AI好医生</h3>
                <Link href="http://gpt.aiputi.cn/?actor=doctor">
                  <Image
                    alt="Original photo"
                    src="http://fileserver.aiputi.cn/logo/doctor_logo.png"
                    className="w-full object-cover rounded-2xl"
                    width={100}
                    height={100}
                  />
                </Link>
              </div>
              
              <div>
                <h3 className="mb-1 font-medium text-lg">AI好律师</h3>
                <Link href="http://gpt.aiputi.cn/?actor=lawyer">
                  <Image
                    alt="Original photo"
                    src="http://fileserver.aiputi.cn/logo/lawyer_logo.png"
                    className="w-full object-cover rounded-2xl"
                    width={100}
                    height={100}
                  />
                </Link>
              </div>
              
              <div>
                <h3 className="mb-1 font-medium text-lg">AI好秘书</h3>
                <Link href="http://gpt.aiputi.cn/?actor=secretary">
                  <Image
                    alt="Original photo"
                    src="http://fileserver.aiputi.cn/logo/secretary_logo.png"
                    className="w-full object-cover rounded-2xl"
                    width={100}
                    height={100}
                  />
                </Link>
              </div>
              
              <div>
                <h3 className="mb-1 font-medium text-lg">AI好老师</h3>
                <Link href="http://gpt.aiputi.cn/?actor=teacher">
                  <Image
                    alt="Original photo"
                    src="http://fileserver.aiputi.cn/logo/teacher_logo.png"
                    className="w-full object-cover rounded-2xl"
                    width={100}
                    height={100}
                  />
                </Link>
              </div>              
              
            </div>
          </div>
        </div>

      </main>
      <Testimonials />
      <Footer />
    </div>
  );
};

// export default Home;
